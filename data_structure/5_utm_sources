-- creating utm sources
CREATE OR REPLACE TABLE UTM_SOURCES (
  CUSTOMER_ID  STRING,                        
  UTM_SOURCE   STRING,
  UTM_MEDIUM   STRING,
  UTM_CAMPAIGN STRING,
  CREATED      TIMESTAMP_NTZ
);

--LOAD .CSV TO THE TABLE
COPY INTO UTM_SOURCES
FROM @STG_RAW_FINANCE/utm_sources.csv
ON_ERROR = 'ABORT_STATEMENT';

-- Add new surrogate key column
ALTER TABLE UTM_SOURCES ADD COLUMN UTM_ID STRING;

-- Populate with UUIDs for existing rows
UPDATE UTM_SOURCES SET UTM_ID = UUID_STRING() WHERE UTM_ID IS NULL;

-- Primary Key constraint
ALTER TABLE UTM_SOURCES ADD CONSTRAINT PK_UTM_SOURCES PRIMARY KEY (UTM_ID);

